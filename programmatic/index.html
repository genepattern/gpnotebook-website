<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Programmatic Features &#8211; Gene Pattern Notebook</title>
    <link rel='stylesheet' id='font-awesome-css' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?ver=4.7.4' type='text/css' media='all'/>
    <script type='text/javascript' src='../wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
    <script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
    <script type='text/javascript' src='../wp-content/themes/genepattern/js/onepagenav.js?ver=4.7.4'></script>
    <script type='text/javascript' src='../wp-content/themes/genepattern/js/stickykit.js?ver=4.7.4'></script>
    <script type='text/javascript' src='../wp-content/themes/genepattern/js/scripts.js?ver=4.7.4'></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-106705148-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments)};
      gtag('js', new Date());

      gtag('config', 'UA-106705148-1');
    </script>
    <link rel='https://api.w.org/' href='../wp-json/'/>
    <style type="text/css">
        h3 a {
            text-decoration: none;
        }
    </style>
    <script type='text/javascript'>
    /* When the user clicks on the button, 
    toggle between hiding and showing the dropdown content */
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }
    /* When the user clicks on the button, 
    toggle between hiding and showing the dropdown content */
    function myFunction2() {
        document.getElementById("myDropdown2").classList.toggle("show");
    }
    // Close the dropdown if the user clicks outside of it
    window.onclick = function(e) {
      if (!e.target.matches('.dropbtn')) {
        var myDropdown = document.getElementById("myDropdown2");
          if (myDropdown.classList.contains('show')) {
            myDropdown.classList.remove('show');
          }
        var myDropdown = document.getElementById("myDropdown");
          if (myDropdown.classList.contains('show')) {
            myDropdown.classList.remove('show');
          }
      }
    }
    </script>
    <link rel="stylesheet" href="../wp-content/themes/genepattern/dropdown.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../wp-content/themes/genepattern/style.css" type="text/css" media="screen"/>
</head>
    
<body class="page-template-default page page-id-9">
    <div id="wrapper">
        <header id="header">
            <div class="container cf">
                <a href=".." id="logo"><img src="../wp-content/themes/genepattern/images/logo.png" alt="Gene Pattern Notebook" /></a>
                <nav>
                    <a href="#" id="mobile-menu"><i class="fa fa-bars"></i></a>
                    <ul id="menu-main-menu" class="menu">
                        <li id="dropdown" class="menu-item">
                            <ol class="dropdown">
                                <li class="dropbtn" onclick="myFunction()" style="margin-left: 0%">Guides</li>
                                <hr style="height: 18px; visibility: hidden;" id="mobile">
                                <div class="dropdown-content" id="myDropdown">
                                    <a href="../user-guide/">Getting Started</a>
                                    <hr style="margin: 1%">
                                    <a href="../basic-features/">Basic Features</a>
                                    <a href="../public-notebooks/">Public Notebooks</a>
                                    <hr style="margin: 1%">
                                    <a href="../programmatic/">Programmatic Features</a>
                                    <a href="../install/">Local Installation</a>
                                    <a href="../for-jupyter-users/">Jupyter Users</a>
                                </div>         
                            </ol>
                        </li>
                        <li id="menu-item-18" class="menu-item"><a href="../tutorials/">Videos/Tutorials</a></li>
                        <li id="menu-item-17" class="menu-item menu-item- ntype-post_type menu-item-object-page menu-item-17"><a href="../faq/">FAQ</a></li>
                        <li id="dropdown" class="menu-item">
                            <ol class="dropdown">
                                <li class="dropbtn" onclick="myFunction2()" style="margin-left: 0%">Resources</li>
                                <hr style="height: 18px; visibility: hidden;" id="mobile">
                                <div class="dropdown-content" id="myDropdown2">
                                    <a href="../community/">Community</a>
                                    <a href="../releases/">Releases</a>
                                    <a href="../example-notebooks/">Example Notebooks</a>
                                    <a href="../cheat-sheet/">Cheat Sheet</a>
                                </div>         
                            </ol>
                        </li>
                        <!-- <li id="menu-item-16" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16"><a href="../documentation/">Documentation</a></li> -->
                        <li id="menu-item-16" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16"><a href="../about/">About</a></li>
                        <li id="menu-item-16" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16"><a href="../contact/">Contact</a></li>
                        <li id="menu-item-51" class="button" style="font-weight: 300"><a href="https://notebook.genepattern.org/hub/login">Login/Register</a></li>
                    </ul>			
                </nav>
            </div>
        </header>
        <div id="main" class="container cf">
            <section>
                <h1>GenePattern Notebook Environment Features</h1>
                <hr>
                <h2 id="programmatic">Programmatic Features</h2>
                <p>In addition to the basic and publishing features intended for use by both non-programming and programming users alike, the GenePattern Notebook environment also provides a variety of features intended primarily for use by coders.</p>

                <h3 id="code-cells">1. Code Cells</h3>
                <p>Code cells allow a user to type in execute Python code. They are the default type of cell. Simply enter the Python code you want to run and then click the <i class="fa-step-forward fa"></i> (run cell) button in the notebook toolbar.</p>
                <p>More information on code cells and their variousoptions is available in the <a href="https://jupyter.readthedocs.io/en/latest/" target="_blank">Jupyter documentation</a>.</p>

                <h3 id="python-library">2. GenePattern Python Library</h3>
                <p>A library is available for using Python to interact with available GenePattern's service. This allows a user to programmatically prepare analyses, launch jobs and retrieve results.</p>
                <p>A complete tutorial on using the GenePattern Python Library is available as a public notebook in the <a href="https://notebook.genepattern.org">GenePattern Notebook Repository</a>. Additional information is available in our <a href="https://github.com/genepattern/example-notebooks/blob/master/GenePattern%20Python%20Tutorial.ipynb" target="_blank">documentation</a>.</p>

                <h3 id="to-code">3. Send to Code</h3>
                <p>The GenePattern Python Library seamlessly integrates with GenePattern cells. Code examples of how to reference GenePattern jobs or GenePattern result files are available in GenePattern Job Cells by clicking a job result and selecting “Send to Code” in the menu.</p>
                <p><img class="alignnone size-full wp-image-40" src="../wp-content/uploads/2017/02/content_screen-shot-2015-10-15-at-13_50.jpg" alt="" width="800" height="212" srcset="../wp-content/uploads/2017/02/content_screen-shot-2015-10-15-at-13_50.jpg 800w, ../wp-content/uploads/2017/02/content_screen-shot-2015-10-15-at-13_50-300x80.jpg 300w, ../wp-content/uploads/2017/02/content_screen-shot-2015-10-15-at-13_50-768x204.jpg 768w" sizes="(max-width: 800px) 100vw, 800px"></p>

                <h3 id="to-dataframe">4. Send to Dataframe</h3>
                <p>The GenePattern Python Library also provides functionality for common GenePattern file formats, allowing them seamlessly integrate with <a href="http://pandas.pydata.org/" target="_blank">Pandas</a>, a popular Python data analysis library.</p>
                <p>Both the <a href="http://software.broadinstitute.org/cancer/software/genepattern/file-formats-guide" target="_blank">GCT and ODF file formats</a> are easily loaded as Pandas Dataframes. Code examples of how to load these files are available in GenePattern Job Cells by clicking a GCT or ODF job result and selecting “Send to Dataframe” in the menu.</p>

                <h3 id="python-variable">5. Python Variable Input</h3>
                <p>As part of the seamless integration between Python and GenePattern, Python variables may be directly used as input in GenePattern Analysis Cells. To use a Python variable as input, first define the variable in a code cell, then in a GenePattern Analysis cell, enter the variable name surrounded by two sets of curly brackets. For example, using the variable <code>foo</code> would appear as <code>{{ foo }}</code></p>
                <p>When the <em>Run</em> button is clicked to launch the analysis job, the notebook will first obtain the value of the variable used as input and then send that to the GenePattern server. As the GenePattern services expect a string, non-string variables will be cast as strings when they are evaluated.</p>

                <h3 id="r-support">6. R Support</h3>
                <p>The GenePattern Notebook Environment supports R through the use of R magic commands. To begin using R magics, you first need to load the R magics extension. This can be achieved by running the following code within your notebook: <code>%load_ext rpy2.ipython</code></p>
                <p>After the extension has been loaded, beginning a cell with <code>%%R</code> will tell the notebook environment to execute the rest of the code in the cell using R rather than Python. An example is given below.</p>
                <code>
                    %%R<br/><br/>
                    # Define a vector with 5 values and show the plot<br/>
                    values <- c(1, 3, 6, 4, 9)<br/>
                    plot(values, type="o", col="blue")<br/>
                    title(main="Example Plot Created With R", col.main="red", font.main=4)
                </code>

                <h3 id="result-syntax">7. Job Result Syntax</h3>
                <p>When specifying the input to a GenePattern analysis cell, a simple syntax can be used to select the output of a upstream job. To do this, inside double curly brackets, write the name of the GenePattern module and extension of the output file separated by a period. If multiple jobs exist in the notebook using that module, or multiple files are returned of that type, an index can optionally be specified in square brackets. Several examples are given below.</p>
                <p>
                    <code>{{ PreprocessDataset.gct }}</code>
                    Use the first GCT file output by the first PreprocessDataset job in the notebook.
                </p>
                <p>
                    <code>{{ PreprocessDataset[1].gct[1] }}</code>
                    This is functionally the same as the first example, but the index is made explicit for both which PreprocessDataset job in the notebook to use and which GCT file to use.
                </p>

                <p>
                    <code>{{ PCA[2].odf }}</code>
                    Use the first ODF file output by the second PCA job.
                </p>

                <p>
                    <code>{{ FlowMeansCluster.csv[3] }}</code>
                    Use the third CSV file output by the first FlowMeansCluster job.
                </p>

                <h2 id="ui-builder">UI Builder</h2>
                <p>The UI Builder is a way to display any Python function or method call as an interactive widget. This will render the parameters of the
                    function as a web form.</p>
                <p>The UI Builder will use any existing docstring for the function as a description, will infer parameter types from default values and will
                    display parameter annotations as helpful text near each input.</p>
                <p><img alt="" src="ui_builder_1.jpg" style="width: 100%;"/></p>

                <h3>1. Build the UI</h3>
                <p>The simplest way to render a function using the UI Builder is to import the <em>genepattern</em> package and then attach the <em>build_ui</em>
                    decorator to the function's definition. A code example for this is given below:</p>

                <code><pre>
import genepattern

@genepattern.build_ui
def example_function(first_parameter, second_parameter):
    . . .</pre></code>

                <p>Alternatively, the UI Builder widget may defined and referenced directly. To render a function in this way, simply import the
                    <em>GPUIBuilder</em> class from the <em>genepattern</em> package and pass the function to the <em>GPUIBuilder</em> constructor. To display
                    the widget, just return the <em>GPUIBuilder</em> object in a Jupyter code cell. A code example is provided below:</p>

                <code><pre>
from genepattern import GPUIBuilder

def example_function(first_parameter, second_parameter):
    . . .

# Create the GPUIBuilder object and immediately
# return it for display in Jupyter
GPUIBuilder(example_function)</pre></code>


                <h3>2. Python Variables & String Literals</h3>
                <p>Python variables may be used as input when filling out a UI Builder form.  To do this, simply type the name of the variable into the
                    input field. When the form is submitted, the widget will pass a reference to the variable to the resulting function call.</p>

                <p><img alt="" src="ui_builder_2.jpg" style="width: 100%;"/></p>

                <p>Conversely, to ensure that an input value is evaluated as a string literal rather than a variable name, a user can wrap the input to a
                    particular field in either single or double quotes (<em>'</em> or <em>"</em>). This tells the UI Builder to skip checking for variable names
                    and to treat the value in quotes as a literal string. For example, forcing the string <em>foo</em> to be treated as a string literal would
                    be entered in the input field as:</p>
                <code>"foo"</code>

                <h3>3. String Serialization</h3>

                <p>The input to a UI Builder form may include a string representation of a variable's <em>value</em> rather than a reference to the variable
                    itself. This is useful for embedding the value inside a larger string, or when passing a variable reference would be unwanted.</p>
                <p>This functionality can be achieved by placing the variable name inside double curly brackets. For example, embedding the string
                    serialization of the variable <em>foo</em> would be entered into an input field as:</p>
                <code>{{ foo }}</code>

                <p><img alt="" src="ui_builder_3.jpg" style="width: 100%;"/></p>

                <h3>4. Rendering Existing Functions</h3>

                <p>Existing Python functions, such as those included in third-party Python libraries, can also be used with the UI Builder. To display an
                    existing function first import it and then pass the function into the constructor of the <em>GPUIBuilder</em> object. Return this object in
                    a cell to display the resulting widget. For example, the code for displaying <em>scikit-learn</em>'s KMeans function is given below.</p>

                <code><pre>
import genepattern
import sklearn.cluster

genepattern.GPUIBuilder(sklearn.cluster.KMeans)</pre></code>

                <h3>5. Overriding Properties</h3>

                <p>By default, the widget name will be the function name, the description will be the docstring of the function and the parameter names will be the
                    same as the parameters defined in the code. All of these, however, can be manually overridden. This is particularly useful whe providing
                    better names or descriptions that users would find helpful.</p>
                <p>To override the default values, optional parameters may be passed into the <em>build_ui</em> decorator or into the <em>GPUIBuilder</em>
                    constructor. Examples overriding the widget name and description are given below.</p>
                <p>The bottom example also demonstrates overriding the canonical name of the function being rendered. This is sometimes helpful if the function
                    has been imported into the code in a non-top level namespace.</p>
                <code><pre>
@genepattern.build_ui(name="Simple Example",
                      description="This is an example function.")
def example_function(param_1, param_2):
    . . .</pre></code>
                <p>The same effect can be also achieved when directly instantiating the <em>GPUIBuilder</em> object.</p>
                <code><pre>
genepattern.GPUIBuilder(sklearn.cluster.KMeans,
                        name="KMeans Clustering",
                        description="Groups data into K clusters",
                        function_import="sklearn.cluster.KMeans")</pre></code>

                <p><img alt="" src="ui_builder_4.jpg" style="width: 100%;"/></p>

                <h3>6. Overriding Parameters</h3>

                <p>The names and descriptions of individual parameters may also be overridden. In this case, a dictionary may be passed to the <em>build_ui</em>
                    decorator or the <em>GPUIBuilder</em> constructor with the parameter's name as the key and the properties to override as the value.</p>
                <p>A code example is given below which overrides the name of a parameter, the description of the parameter and the default value of the parameter.</p>
                <code><pre>
@genepattern.build_ui(parameters={
    "param_1": {
        "name": "foo",
        "description": "This parameter has been renamed.",
        "default": "bar"
    }
})
def example_function(param_1, param_2):
    . . .</pre></code>

                <p><img alt="" src="ui_builder_5.jpg" style="width: 100%;"/></p>

                <h3>7. Hiding Parameters</h3>
                <p>Sometimes a particular function has parameters that shouldn't be changed in the current context. The UI Builder has the ability to hide the
                    input for these parameters, simplifying the user interface and allowing users to focus only on the relevant inputs. When the function is
                    called, the hidden parameters will automatically use their default values. This may be combined with overriding the default value for
                    the parameter in question in order to force a particular input.</p>
                <p>A code example is given below in which several parameters of <em>scikit-learn</em>'s KMeans implementation are hidden.</p>

                <code><pre>
genepattern.GPUIBuilder(sklearn.cluster.KMeans, parameters={
    "init": { "hide": True },
    "verbose": { "hide": True },
    "random_state": { "hide": True, "default": 1234 },
    "copy_x": { "hide": True }
})</pre></code>

                <p><img alt="" src="ui_builder_6.jpg" style="width: 100%;"/></p>
                
                <h3>8. Output Variable</h3>
                <p>The result of a UI Builder function can optionally be assigned to a Python variable. By default, a text field for this variable will appear at the bottom of each UI Builder widget. This field can be overridden just like any other parameter using the <em>output_var</em> parameter name. This includes the ability to change the label, description, assign a default value or hide the parameter. A code example is given below.</p>
                
                <code><pre>
@genepattern.build_ui(parameters={
    "output_var": {
        "name": "results",
        "description": "The results of the function",
        "default": "variable_name",
        "hide": False,
    }
})
def example_function(a_text_param, a_number_param,
                     a_password_param, a_bool_param=True):
    . . .</pre></code>

                <h3>9. Parameter Types</h3>
                <p>The UI Builder supports a number of parameter types and implements features to make handling those types easier. Supported types include:</p>
                <ul>
                    <li><strong>Text:</strong> Supports any text value. Unless referencing an existing Python variable, any input gets cast to a Python string
                        value. Text is also the default parameter type if no other type information has been specified or can be determined.</li>
                    <li><strong>Number:</strong> Accepts any numerical value and renders in a notebook as an HTML number input.</li>
                    <li><strong>Password:</strong> Works exactly like a text input, but obfuscates the input value as a password field.</li>
                    <li><strong>Choice:</strong> When provided with a list of choices, this input will render as a dropdown parameter, with the default value
                        selected. Choice parameters are described in their own section below.</li>
                    <li><strong>Bool:</strong> A boolean input representing True and False. Renders as a choice parameter with those two choices.</li>
                    <li><strong>File:</strong> An input intended to receive a file or file-like object. File parameters are described in their own section
                        below.</li>
                </ul>

                <p>The UI Builder will infer a parameter's type from its default value, defaulting to a text parameter if no value is available or if the
                    default value's type doesn't match one of the known types above. Alternatively, the developer can specify a parameter's type in the code. A
                    code example is provided below, illustrating how to specify each type - except for choice and file parameters, which are each detailed in
                    their own sections.</p>

                <code><pre>
@genepattern.build_ui(parameters={
    "a_text_param": {
        "type": "text"
    },
    "a_number_param": {
        "type": "number"
    },
    "a_password_param": {
        "type": "password"
    },
    "a_bool_param": {
        "type": "bool"
    },
})
def example_function(a_text_param, a_number_param,
                     a_password_param, a_bool_param=True):
    . . .</pre></code>

                <p><img alt="" src="ui_builder_8.jpg" style="width: 100%;"/></p>

                <h3>10. Choice Parameters</h3>
                <p>Sometimes a parameter only accepts a limited set of valid input values. This is often represented in a user interface as a dropdown
                    (<em>select</em>) input. The UI Builder has support for this functionality. To change a particular parameter into a dropdown input, simply
                    provide the parameter with a dictionary of available choices. A code example is given below.</p>
                <code><pre>
@genepattern.build_ui(parameters={
    "param_1": {
        "default": "some_value",
        "type": "choice",
        "choices": {
            "foo label": "foo value",
            "bar label": "bar value",
            "some_label": "some_value"
        }
    }
})
def example_function(param_1, param_2):
    . . .</pre></code>

                <p><img alt="" src="ui_builder_7.jpg" style="width: 100%;"/></p>

                <h3>11. File Parameters</h3>
                <p>File parameters are intended to handle input representing a file or file-like object. They are integrated with GenePattern job widgets, such
                    that available GenePattern files will appear in a menu when a file parameter is first selected, thereby allowing the user to easily select
                    the desired file.</p>
                <p>Optionally, the developer can specify the kinds of files that a file parameter accepts. This is accomplished by providing a list of file
                    extension strings. For example, a parameter that expects a gct, odf or res files would list: <em>["gct", "odf", "res"]</em>.</p>
                <p>It is worth noting that when a GenePattern file is selected in the menu, the value provided to the function will actually be a string
                    containing a URL to the specified file. The developer may then take this string and use it to create a file-like object, pass it to a
                    function that will download the file or otherwise perform any desired tasks.</p>
                <p>A code example is provided below.</p>
                <code><pre>
@genepattern.build_ui(parameters={
    "param_1": {
        "type": "file",
        "kinds": ["gct", "odf"]
    }
})
def example_function(param_1, param_2):
    . . .</pre></code>

                <p><img alt="" src="ui_builder_9.jpg" style="width: 100%;"/></p>
            </section>
            <aside>
                <ul id="section-menu">
                    <li><a href="#programmatic">Programmatic Features</a></li>
                    <li><a href="#ui-builder">UI Builder</a></li>
                </ul>
            </aside>
        </div>
        <footer id="footer">
            <div class="container">
                <p>GenePattern Notebook usage is free and the software is open source under a BSD-style license.</p>
                <p>© 2017 Regents of the University of California and the Broad Institute. </p>
            </div>
        </footer>
    </div>
    <script type='text/javascript' src='../wp-includes/js/wp-embed.min.js?ver=4.7.4'></script>
    
</body>
</html>
